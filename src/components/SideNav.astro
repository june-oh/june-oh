---
import { siteConfig } from "../config";

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
const pubs = siteConfig.publications;
const hasPublications = pubs && (pubs.journals?.length > 0 || pubs.conferences?.length > 0 || pubs.domestic?.length > 0);
const hasTeaching = siteConfig.teaching && siteConfig.teaching.length > 0;
const hasAwards = siteConfig.awards && siteConfig.awards.length > 0;
const hasPatents = siteConfig.patents && siteConfig.patents.length > 0;
const hasCertificates = siteConfig.certificates && siteConfig.certificates.length > 0;
const hasAchievements = hasAwards || hasPatents || hasCertificates;

const navItems = [
  { id: "hero", label: "Home", show: true },
  { id: "about", label: "About", show: true },
  { id: "projects", label: "Research", show: hasProjects },
  { id: "experience", label: "Experience", show: hasExperience },
  { id: "education", label: "Education", show: hasEducation },
  { id: "publications", label: "Publications", show: hasPublications },
  { id: "teaching", label: "Teaching", show: hasTeaching },
  { id: "awards", label: "Achievements", show: hasAchievements },
].filter(item => item.show);
---

<!-- Section dots navigation (Desktop only) -->
<nav
  id="side-nav"
  class="fixed right-4 sm:right-6 top-1/2 -translate-y-1/2 z-40 hidden lg:flex flex-col gap-3 transition-all duration-300"
>
  {navItems.map((item) => (
    <a
      href={`#${item.id}`}
      data-section={item.id}
      class="side-nav-item group relative flex items-center justify-end"
      aria-label={item.label}
    >
      <span 
        class="nav-label absolute right-8 px-2 py-1 text-xs font-medium text-white rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none"
        style={`background-color: ${siteConfig.accentColor}`}
      >
        {item.label}
      </span>
      <span 
        class="nav-dot w-3 h-3 rounded-full border-2 transition-all duration-300"
        style={`border-color: ${siteConfig.accentColor}`}
      />
    </a>
  ))}
</nav>

<!-- Section navigation buttons - Vertical -->
<div
  id="nav-buttons"
  class="fixed right-2 sm:right-4 md:right-6 bottom-4 sm:bottom-6 z-40 flex flex-col items-center gap-0.5 sm:gap-1 transition-all duration-300"
>
  <!-- Current section indicator (hidden on very small screens) -->
  <div 
    id="current-section"
    class="hidden sm:block text-[10px] sm:text-xs font-medium px-1.5 sm:px-2 py-0.5 sm:py-1 rounded mb-0.5 sm:mb-1 whitespace-nowrap shadow-sm"
    style={`background-color: ${siteConfig.accentColor}; color: white`}
  >
    Home
  </div>
  
  <!-- ⏫ Top -->
  <button
    id="nav-top"
    class="nav-btn w-8 h-8 sm:w-9 sm:h-9 rounded-lg shadow-md dark:shadow-slate-900/50 flex items-center justify-center transition-all duration-200 active:scale-95 sm:hover:scale-110 bg-white dark:bg-slate-800 border-2 text-gray-600 dark:text-gray-300 hover:text-white"
    style={`border-color: ${siteConfig.accentColor}; --hover-bg: ${siteConfig.accentColor}`}
    aria-label="Go to top"
    title="맨 위로"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l7.5-7.5 7.5 7.5m-15 6l7.5-7.5 7.5 7.5" />
    </svg>
  </button>
  
  <!-- ▲ Previous section -->
  <button
    id="nav-up"
    class="nav-btn w-8 h-8 sm:w-9 sm:h-9 rounded-lg shadow-md dark:shadow-slate-900/50 flex items-center justify-center transition-all duration-200 active:scale-95 sm:hover:scale-110 bg-white dark:bg-slate-800 border-2 text-gray-600 dark:text-gray-300 hover:text-white"
    style={`border-color: ${siteConfig.accentColor}; --hover-bg: ${siteConfig.accentColor}`}
    aria-label="Previous section"
    title="이전 섹션"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
    </svg>
  </button>
  
  <!-- ▼ Next section -->
  <button
    id="nav-down"
    class="nav-btn w-8 h-8 sm:w-9 sm:h-9 rounded-lg shadow-md dark:shadow-slate-900/50 flex items-center justify-center transition-all duration-200 active:scale-95 sm:hover:scale-110 bg-white dark:bg-slate-800 border-2 text-gray-600 dark:text-gray-300 hover:text-white"
    style={`border-color: ${siteConfig.accentColor}; --hover-bg: ${siteConfig.accentColor}`}
    aria-label="Next section"
    title="다음 섹션"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
    </svg>
  </button>
  
  <!-- ⏬ Bottom -->
  <button
    id="nav-bottom"
    class="nav-btn w-8 h-8 sm:w-9 sm:h-9 rounded-lg shadow-md dark:shadow-slate-900/50 flex items-center justify-center transition-all duration-200 active:scale-95 sm:hover:scale-110 bg-white dark:bg-slate-800 border-2 text-gray-600 dark:text-gray-300 hover:text-white"
    style={`border-color: ${siteConfig.accentColor}; --hover-bg: ${siteConfig.accentColor}`}
    aria-label="Go to bottom"
    title="맨 아래로"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 5.25l-7.5 7.5-7.5-7.5m15 6l-7.5 7.5-7.5-7.5" />
    </svg>
  </button>
</div>

<script define:vars={{ navItems }}>
  const sideNavItems = document.querySelectorAll('.side-nav-item');
  const currentSectionEl = document.getElementById('current-section');
  
  const navTop = document.getElementById('nav-top');
  const navUp = document.getElementById('nav-up');
  const navDown = document.getElementById('nav-down');
  const navBottom = document.getElementById('nav-bottom');
  
  // Section IDs from config
  const sectionIds = navItems.map(item => item.id);
  
  function getCurrentSectionIndex() {
    const scrollPos = window.scrollY + window.innerHeight / 3;
    let currentIndex = 0;
    
    sectionIds.forEach((id, index) => {
      const section = document.getElementById(id);
      if (section) {
        const sectionTop = section.offsetTop;
        if (scrollPos >= sectionTop) {
          currentIndex = index;
        }
      }
    });
    
    return currentIndex;
  }
  
  function updateActiveNav() {
    const currentSectionIndex = getCurrentSectionIndex();
    const currentItem = navItems[currentSectionIndex];
    
    // Update dots
    sideNavItems.forEach((item, index) => {
      const dot = item.querySelector('.nav-dot');
      if (dot) {
        if (index === currentSectionIndex) {
          dot.style.backgroundColor = getComputedStyle(dot).borderColor;
          dot.style.transform = 'scale(1.3)';
        } else {
          dot.style.backgroundColor = 'transparent';
          dot.style.transform = 'scale(1)';
        }
      }
    });
    
    // Update current section text
    if (currentSectionEl && currentItem) {
      currentSectionEl.textContent = currentItem.label;
    }
  }
  
  function scrollToSection(index) {
    if (index >= 0 && index < sectionIds.length) {
      const section = document.getElementById(sectionIds[index]);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
      }
    }
  }
  
  // Navigation button handlers
  navTop?.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  
  navUp?.addEventListener('click', () => {
    const current = getCurrentSectionIndex();
    if (current > 0) {
      scrollToSection(current - 1);
    }
  });
  
  navDown?.addEventListener('click', () => {
    const current = getCurrentSectionIndex();
    if (current < sectionIds.length - 1) {
      scrollToSection(current + 1);
    }
  });
  
  navBottom?.addEventListener('click', () => {
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  });
  
  window.addEventListener('scroll', updateActiveNav);
  window.addEventListener('load', updateActiveNav);
</script>

<style>
  .side-nav-item:hover .nav-dot {
    transform: scale(1.3);
  }
  
  .nav-btn:hover {
    background-color: var(--hover-bg) !important;
  }
  
  /* Touch feedback for mobile */
  @media (hover: none) {
    .nav-btn:active {
      background-color: var(--hover-bg) !important;
    }
  }
</style>
